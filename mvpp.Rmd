---
title: "Multivariate post-processing"
author: "Jieyu Chen"
date: "10/05/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```


```{r start, include=FALSE}
library(scoringRules)
library(lubridate)
library(crch)
library(tidyverse)
library(ggplot2)
library(ensembleBMA)
load("E:/0-TIGGE_ECMWF_Germany/ecmwf_ens_subset_unipp.RData")
load("E:/0-TIGGE_ECMWF_Germany/ecmwf_ens_subset_mvpp.RData")

```


```{r score, echo=TRUE, message=FALSE, warning=FALSE}
print("Univariate post-processing: CRPS")
summary(crps_ens)
summary(crps_emosloc_fix9y)
summary(crps_emosloc_rolling28d)
summary(crps_emosglob_fix9y)

print("Univariate post-processing: rank/PIT histograms")
hist(rank_ens)
hist(pit_emosloc_fix9y)
hist(pit_emosloc_rolling28d)
hist(pit_emosglob_fix9y)

print("Multivariate post-processing: Energy score")
summary(es_ens)
summary(es_emos)
summary(es_ecc)
summary(es_ssh)
summary(es_gca)

print("Multivariate post-processing: Variogram score p=0.5")
summary(vs_ens)
summary(vs_emos)
summary(vs_ecc)
summary(vs_ssh)
summary(vs_gca)

```

```{r rankhist, echo=FALSE, message=FALSE, warning=FALSE}

print("Raw ensemble members:")
verifRankHist(data_eval_all[,6:55],data_eval_all[,3])
print("EMOS-Q, ECC-Q, SSH-Q:")
verifRankHist(emos_eval_all[,6:55],emos_eval_all[,3])
print("GCA:")
verifRankHist(gca_eval_all[,6:55],gca_eval_all[,3])

print("Multivariate rank histograms using the average rank:")
hist(ecc_avr)
hist(ssh_avr)
hist(gca_avr)
hist(emos_avr)
hist(ens_avr)

print("Multivariate rank histograms using the band depth rank:")
hist(ecc_bdr)
hist(ssh_bdr)
hist(gca_bdr)
hist(emos_bdr)
hist(ens_bdr)

print("Multivariate rank histograms using the multivariate rank:")
hist(ecc_mvr)
hist(ssh_mvr)
hist(gca_mvr)
hist(emos_mvr)
hist(ens_mvr)

```